---
import type { MDXInstance, GetStaticPaths, Page } from 'astro';
import BlogLayout from '@layouts/BlogLayout.astro';
export type Props = {
  page: Page<MDXInstance<PostFrontmatter>>;
  tagData: Tag;
};

import { tags } from '@data/tags';
import type { PostFrontmatter, Tag } from 'src/types';
import { queryPosts } from '@utils/posts';
import PaginatedPostList from '@src/components/PaginatedPostList.astro';

export const getStaticPaths: GetStaticPaths = async ({ paginate }) => {
  console.log('Building paths for blog tags');

  const allPosts = [
    ...(await Astro.glob<PostFrontmatter>('../../posts/*.mdx')),
  ];

  // astro no longer flattens this
  return tags['blog'].flatMap((tag) => {
    const tagPosts = queryPosts(allPosts, { tag: tag.name });

    return paginate(tagPosts, {
      params: { tag: tag.name },
      props: { tagData: tag },
      pageSize: parseInt(import.meta.env.POST_PAGE_SIZE),
    });
  });
};

const { page, tagData } = Astro.props;
---

<BlogLayout metaTags={{ title: `JG - ${tagData.title}` }}>
  <PaginatedPostList title={tagData.title} page={page} />
</BlogLayout>

<style lang="css">
  .tag-title {
    text-align: center;
  }
</style>

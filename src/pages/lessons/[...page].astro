---
import { GetStaticPaths, MarkdownInstance, Page } from 'astro';
import SectionLayout from '@layouts/SectionLayout.astro';
import { PostFrontmatter } from '@src/types';
import { queryPosts } from '@src/utils/posts';
import PaginatedPostList from '@src/components/PaginatedPostList.astro';

export type Props = {
  page: Page<MarkdownInstance<PostFrontmatter>>;
};

export const getStaticPaths: GetStaticPaths = async ({ paginate }) => {
  console.log('Building paths for blog tags');

  const allPosts = [...(await Astro.glob<PostFrontmatter>('./posts/*.mdx'))];
  const sortedPosts = queryPosts(allPosts, {
    tag: 'final',
  });

  return paginate(sortedPosts, {
    pageSize: parseInt(import.meta.env.POST_PAGE_SIZE),
  });
};

const { page } = Astro.props;
---

<SectionLayout
  metaTags={{ title: 'JG - Lessons', description: 'Mostly Church Lessons' }}
  logoPath="/lessons"
>
  <PaginatedPostList title="Lessons" page={page} />
</SectionLayout>
